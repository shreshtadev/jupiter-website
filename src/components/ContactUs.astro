---
const RECAPTCHA_SITE_KEY = import.meta.env.PUBLIC_RECAPTCHA_SITE_KEY;
const recaptchaScript = `
  function attachRecaptchaHandler() {
    const form = document.getElementById("contact-form");
    const submitBtn = document.getElementById("contact-submit-btn");
    const tokenInput = document.getElementById("g-recaptcha-response");
    if (!form && !tokenInput) return;

    form.addEventListener("submit", function (event) {
      event.preventDefault();

      if (!window.grecaptcha) {
        alert("reCAPTCHA is not ready.");
        return;
      }

      submitBtn?.setAttribute("disabled", "true");

      grecaptcha.ready(function() {
        grecaptcha.execute('${RECAPTCHA_SITE_KEY}', { action: "contact_form" })
          .then(function(token) {
            tokenInput.value = token;
            form.submit();
          })
          .catch(function(error) {
            submitBtn?.removeAttribute("disabled");
            debugger;
            console.error("reCAPTCHA Token Generation Failed:", error);
            alert("reCAPTCHA failed. Please try again.");
          });
      });
    });
  }

  if (document.readyState === "loading") {
    document.addEventListener("DOMContentLoaded", attachRecaptchaHandler);
  } else {
    attachRecaptchaHandler();
  }
`;
const projectType = [
  { value: "webapp", label: "Web application" },
  { value: "mobileapp", label: "Mobile app" },
  { value: "staticweb", label: "Static Website" },
  { value: "saas", label: "API / backend" },
  { value: "consulting", label: "Consultation" },
  { value: "other", label: "Other" },
];
---

<section
  id="contact"
  class="ssection-with-bg section-block reveal-section scroll-mt-24 px-4 pb-24 md:pb-32"
>
  <!-- Retro dot grid background -->
  <div class="section-inner">
    <div
      class="pointer-events-none absolute inset-0 -z-10 opacity-60"
      aria-hidden="true"
    >
      <div
        class="h-full w-full bg-[radial-gradient(circle_at_1px_1px,rgba(148,163,184,0.3)_1px,transparent_0)] bg-size-[18px_18px]"
      >
      </div>
    </div>
    <div
      class="card bg-base-200/95 border border-primary/40 shadow-2xl shadow-primary/25"
    >
      <!-- Neon border glow -->
      <div
        class="pointer-events-none absolute inset-0 -z-10 rounded-3xl bg-[conic-gradient(at_top,rgba(96,165,250,0.35),rgba(244,114,182,0.4),rgba(52,211,153,0.35),rgba(96,165,250,0.35))] opacity-30 blur-2xl"
        aria-hidden="true"
      >
      </div>
      <div class="card-body space-y-10 md:space-y-12">
        <!-- HEADER -->
        <div class="text-center space-y-4">
          <h2 class="font-display text-3xl md:text-4xl">
            Let&quot;s Build Something Great Together
          </h2>
          <p
            class="mx-auto max-w-2xl text-sm text-base-content/80 md:text-base"
          >
            Share a bit about your product, timeline, and constraints. I’ll help
            you shape it into a fast, scalable, and visually polished digital
            experience.
          </p>
        </div>
        <!-- GRID: CONTACT INFO + FORM + MAP -->
        <div class="grid gap-8 lg:grid-cols-[1.1fr_1.3fr]">
          <!-- LEFT: CONTACT INFO + MAP -->
          <div class="space-y-6">
            <!-- Contact info cards -->
            <div class="grid gap-4 sm:grid-cols-2">
              <!-- PHONE -->
              <div
                class="rounded-box border border-base-300 bg-base-100/80 p-5 space-y-3 hover:shadow-md transition-shadow"
              >
                <div class="flex items-center gap-3">
                  <svg
                    xmlns="http://www.w3.org/2000/svg"
                    class="h-6 w-6 text-primary"
                    fill="none"
                    viewBox="0 0 24 24"
                    stroke="currentColor"
                  >
                    <path
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      stroke-width="1.5"
                      d="M2.25 4.5l4.72-1.26a2.25 2.25 0 012.7 1.46l1.04 2.86a2.25 2.25 0 01-.52 2.33L8.6 11.4a16.5 16.5 0 006 6l1.51-1.57a2.25 2.25 0 012.33-.52l2.86 1.04a2.25 2.25 0 011.46 2.7L21 21.75a2.25 2.25 0 01-2.25 2.25A16.5 16.5 0 012.25 4.5z"
                    ></path>
                  </svg>
                  <p class="text-xs font-semibold uppercase tracking-[0.18em]">
                    Phone
                  </p>
                </div>
                <a
                  href="tel:+918431188247"
                  class="text-base hover:text-primary"
                >
                  +91 8431188247
                </a>
              </div>
              <!-- EMAIL -->
              <div
                class="rounded-box border border-base-300 bg-base-100/80 p-5 space-y-3 hover:shadow-md transition-shadow"
              >
                <div class="flex items-center gap-3">
                  <svg
                    xmlns="http://www.w3.org/2000/svg"
                    class="h-6 w-6 text-primary"
                    fill="none"
                    viewBox="0 0 24 24"
                    stroke="currentColor"
                  >
                    <path
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      stroke-width="1.5"
                      d="M21.75 7.5v9a2.25 2.25 0 01-2.25 2.25h-15A2.25 2.25 0 012.25 16.5v-9m19.5 0L12 13.5 2.25 7.5m19.5 0A2.25 2.25 0 0019.5 6h-15a2.25 2.25 0 00-2.25 1.5"
                    ></path>
                  </svg>
                  <p class="text-xs font-semibold uppercase tracking-[0.18em]">
                    Email
                  </p>
                </div>
                <a
                  href="mailto:shreshtha.smg@gmail.com"
                  class="text-base hover:text-primary"
                >
                  shreshtha.smg@gmail.com
                </a>
              </div>
              <!-- ADDRESS -->
              <div
                class="sm:col-span-2 rounded-box border border-base-300 bg-base-100/80 p-5 space-y-3 hover:shadow-md transition-shadow"
              >
                <div class="flex items-center gap-3">
                  <svg
                    xmlns="http://www.w3.org/2000/svg"
                    class="h-6 w-6 text-primary"
                    fill="none"
                    viewBox="0 0 24 24"
                    stroke="currentColor"
                  >
                    <path
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      stroke-width="1.5"
                      d="M12 21.75s-7.5-4.64-7.5-10.5A7.5 7.5 0 0112 3.75a7.5 7.5 0 017.5 7.5c0 5.86-7.5 10.5-7.5 10.5z"
                    ></path>
                    <circle cx="12" cy="11.25" r="2.25"></circle>
                  </svg>
                  <p class="text-xs font-semibold uppercase tracking-[0.18em]">
                    Address
                  </p>
                </div>
                <p class="text-base leading-relaxed">
                  JAI BHAVANI NIVAS, Punith Rajkumar Badavane<br />
                  Alkola, Vinobanagara, Shivamogga, Karnataka 577204<br />
                  India
                </p>
              </div>
            </div>
            <!-- Map card -->
            <div
              class="rounded-box border border-base-300 bg-base-100/80 p-4 space-y-3"
            >
              <div class="flex items-center justify-between gap-3">
                <p class="text-xs font-semibold uppercase tracking-[0.18em]">
                  Location
                </p>
                <span class="badge badge-outline badge-sm">
                  SHIVAMOGGA · IST
                </span>
              </div>
              <div class="aspect-4/3 w-full overflow-hidden rounded-box">
                <!-- Replace src with your own embed link if you want -->
                <!-- <iframe
                  src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d3872.174812303365!2d75.5397438762135!3d13.948194692713926!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x3bbbafea66e693c1%3A0x792566a84a992237!2sJai%20Bhavani%20Nivas!5e0!3m2!1sen!2sin!4v1764156232545!5m2!1sen!2sin"
                  width="400"
                  height="300"
                  style="border:0;"
                  title="location-shreshtasmg.in"
                  allowfullscreen
                  loading="lazy"
                  referrerpolicy="no-referrer-when-downgrade"></iframe> -->
              </div>
            </div>
          </div>
          <!-- RIGHT: CONTACT FORM -->
          <div
            class="rounded-box border border-base-300 bg-base-100/90 p-6 md:p-7"
          >
            <div class="space-y-1 mb-5">
              <p
                class="text-xs font-semibold uppercase tracking-[0.2em] text-base-content/60"
              >
                Contact form
              </p>
              <p class="text-sm text-base-content/80">
                Share a quick overview. I&quot;ll get back to you with next
                steps and timelines.
              </p>
            </div>
            <form
              id="contact-form"
              class="grid gap-4"
              method="post"
              action="/api/contact"
            >
              <div class="form-control w-full">
                <label class="label px-0 pb-1">
                  <span class="label-text text-xs uppercase tracking-[0.18em]">
                    Name
                  </span>
                </label>
                <input
                  type="text"
                  name="name"
                  placeholder="Your name"
                  class="input input-bordered w-full"
                  required
                />
              </div>
              <div class="form-control w-full">
                <label class="label px-0 pb-1">
                  <span class="label-text text-xs uppercase tracking-[0.18em]">
                    Email
                  </span>
                </label>
                <input
                  type="email"
                  name="email"
                  placeholder="you@example.com"
                  class="input input-bordered w-full"
                  required
                />
              </div>
              <div class="form-control w-full">
                <label class="label px-0 pb-1">
                  <span class="label-text text-xs uppercase tracking-[0.18em]">
                    Project type
                  </span>
                </label>
                <select
                  name="projectType"
                  class="select select-bordered w-full"
                >
                  {
                    projectType.map((pt) => (
                      <option value={pt.value}>{pt.label}</option>
                    ))
                  }
                </select>
              </div>
              <div class="form-control w-full">
                <label class="label px-0 pb-1">
                  <span class="label-text text-xs uppercase tracking-[0.18em]">
                    Project details
                  </span>
                </label>
                <textarea
                  name="message"
                  class="textarea textarea-bordered w-full min-h-[120px]"
                  placeholder="Tell me about the problem, scope, and timeline..."
                  required></textarea>
              </div>
              <!-- reCAPTCHA token (if you're using v3) -->
              <input
                type="hidden"
                name="g-recaptcha-response"
                id="g-recaptcha-response"
              />
              <div
                class="flex flex-wrap items-center justify-between gap-3 pt-2"
              >
                <button
                  type="submit"
                  class="btn btn-primary normal-case"
                  id="contact-submit-btn"
                >
                  Send message
                </button>
                <a href="#top" class="btn btn-ghost normal-case">
                  Back to top
                </a>
              </div>
              <p class="text-[0.7rem] text-base-content/60 pt-1">
                Protected by reCAPTCHA. The Google
                <a href="https://policies.google.com/privacy" class="link"
                  >Privacy Policy</a
                >
                and
                <a href="https://policies.google.com/terms" class="link"
                  >Terms of Service</a
                >
                apply.
              </p>
            </form>
          </div>
        </div>
      </div>
    </div>
  </div>
</section>
<script set:html={recaptchaScript} />
